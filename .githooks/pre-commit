#!/bin/sh

# Add Go bin to PATH
export PATH="$PATH:$(go env GOPATH)/bin"

echo "Running pre-commit checks..."

# Format check
echo "Checking formatting..."
if [ -n "$(gofmt -s -l .)" ]; then
    echo "ERROR: Code is not formatted. Run 'go fmt ./...' or 'gofmt -s -w .'"
    gofmt -s -l .
    exit 1
fi

# Vet
echo "Running go vet..."
if ! go vet ./...; then
    echo "ERROR: go vet failed"
    exit 1
fi

# Lint
echo "Running golangci-lint..."
if ! command -v golangci-lint > /dev/null; then
    echo "ERROR: golangci-lint not installed"
    echo "Run 'make setup-hooks' to install required dependencies"
    exit 1
fi
if ! golangci-lint run ./...; then
    echo "ERROR: golangci-lint failed"
    exit 1
fi

echo "Pre-commit checks passed!"
exit 0
