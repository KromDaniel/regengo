# Generated Tests

Regengo automatically generates a `_test.go` file alongside your output file (unless disabled with `-no-test`). This file contains correctness tests and benchmarks that compare against Go's stdlib `regexp`.

## What's Generated

### Correctness Tests

Verifies that regengo's output matches `regexp` stdlib exactly:

- `Test...MatchString` - Validates boolean matching
- `Test...MatchBytes` - Validates byte-slice matching
- `Test...FindString` - Validates captures against `FindStringSubmatch`
- `Test...FindAllString` - Validates all matches against `FindAllStringSubmatch`

### Benchmarks

Comparison benchmarks to measure speedup vs stdlib:

- `Benchmark...MatchString` - Performance of simple matching
- `Benchmark...FindString` - Performance with capture extraction
- `Benchmark...FindStringReuse` - Performance with zero-allocation reuse

## Generating Tests

**CLI**: Tests are generated by default (disable with `-no-test`)

**Library**: Tests are generated when `TestFileInputs` is provided (which auto-enables `GenerateTestFile`)

### CLI

```bash
# Generate with default test inputs
regengo -pattern '(?P<year>\d{4})-(?P<month>\d{2})-(?P<day>\d{2})' \
        -name Date -output date.go

# Generate with custom test inputs
regengo -pattern '(?P<year>\d{4})-(?P<month>\d{2})-(?P<day>\d{2})' \
        -name Date -output date.go \
        -test-inputs "2024-01-01,2025-12-31,1999-06-15"

# Disable test generation
regengo -pattern '...' -name Date -output date.go -no-test
```

### Library

```go
err := regengo.Compile(regengo.Options{
    Pattern:          `(?P<year>\d{4})-(?P<month>\d{2})-(?P<day>\d{2})`,
    Name:             "Date",
    OutputFile:       "date.go",
    Package:          "main",
    TestFileInputs:   []string{"2024-01-01", "2025-12-31"}, // Auto-enables GenerateTestFile
})
```

## Running Generated Tests

```bash
# Run tests
go test -v

# Run benchmarks
go test -bench=. -benchmem

# Run specific benchmark
go test -bench=BenchmarkDateFindString -benchmem
```

## Example Generated Test File

For a date pattern with captures, regengo generates (see [full example](../benchmarks/generated/DateCapture_test.go)):

```go
package main

import (
    "regexp"
    "testing"
)

func TestDateFindString(t *testing.T) {
    pattern := `(?P<year>\d{4})-(?P<month>\d{2})-(?P<day>\d{2})`
    stdReg := regexp.MustCompile(pattern)

    t.Run("test input 0", func(t *testing.T) {
        input := "2024-01-01"
        stdMatch := stdReg.FindStringSubmatch(input)
        regengoResult, found := CompiledDate.FindString(input)

        if (len(stdMatch) > 0) != found {
            t.Fatalf("match mismatch: std=%v, regengo=%v", len(stdMatch) > 0, found)
        }

        if found {
            if stdMatch[0] != regengoResult.Match {
                t.Errorf("Full match mismatch: std=%q regengo=%q",
                    stdMatch[0], regengoResult.Match)
            }
        }
    })
}

func BenchmarkDateFindString(b *testing.B) {
    pattern := `(?P<year>\d{4})-(?P<month>\d{2})-(?P<day>\d{2})`
    stdReg := regexp.MustCompile(pattern)

    b.Run("golang std", func(b *testing.B) {
        b.ReportAllocs()
        input := "2024-01-01"
        for b.Loop() {
            stdReg.FindStringSubmatch(input)
        }
    })

    b.Run("regengo", func(b *testing.B) {
        b.ReportAllocs()
        input := "2024-01-01"
        for b.Loop() {
            CompiledDate.FindString(input)
        }
    })

    b.Run("regengo reuse", func(b *testing.B) {
        b.ReportAllocs()
        input := "2024-01-01"
        var result *DateResult
        for b.Loop() {
            result, _ = CompiledDate.FindStringReuse(input, result)
        }
    })
}
```

## Benchmark Output Example

```
BenchmarkDateFindString/golang_std     10748672    111.3 ns/op    128 B/op    2 allocs/op
BenchmarkDateFindString/regengo        55888143     20.5 ns/op     64 B/op    1 allocs/op
BenchmarkDateFindString/regengo_reuse 157400960      7.5 ns/op      0 B/op    0 allocs/op
```

## Debugging Test Failures

If a generated test fails, it indicates a behavioral difference between regengo and stdlib:

```bash
# See detailed engine analysis
regengo -pattern 'your-pattern' -name Test -output test.go -verbose

# Analyze pattern without generating code
regengo -analyze -pattern 'your-pattern'
```

## More Examples

See [benchmarks/generated/](../benchmarks/generated/) for more examples of generated test files.
